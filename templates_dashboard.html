<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Solar Memorials</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="main-layout">
        <!-- SIDEBAR -->
        <aside class="sidebar">
            <div class="sidebar-brand">
                <span>‚òÄÔ∏è</span>
                <span>Solar Pro</span>
            </div>
            
            <nav class="sidebar-nav">
                <li class="sidebar-nav-item">
                    <a href="{{ url_for('dashboard') }}" class="sidebar-nav-link active">
                        <span>üìä</span>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="sidebar-nav-item">
                    <a href="{{ url_for('novo_projeto') }}" class="sidebar-nav-link">
                        <span>üìÑ</span>
                        <span>Memoriais</span>
                    </a>
                </li>
            </nav>
            
            <div class="sidebar-section">
                <div class="sidebar-section-title">Projetos Recentes</div>
                <ul class="projects-list">
                    {% if projetos %}
                        {% for projeto in projetos[:5] %}
                            <li class="projects-list-item" onclick="window.location.href='{{ url_for('editar_projeto', projeto_id=projeto.id) }}'">
                                <div class="projects-list-item-name">{{ projeto.nome_cliente }}</div>
                                <div class="projects-list-item-meta">{{ projeto.cidade }}/{{ projeto.uf }} ‚Ä¢ {{ projeto.potencia_kwp }} kWp</div>
                            </li>
                        {% endfor %}
                    {% else %}
                        <li class="projects-list-item" style="opacity: 0.5;">
                            <div class="projects-list-item-name">Nenhum projeto</div>
                        </li>
                    {% endif %}
                </ul>
            </div>
            
            <div style="margin-top: auto; padding-top: 2rem; border-top: 1px solid var(--border);">
                <div style="font-size: 0.85rem; color: var(--text-secondary);">
                    <strong>{{ current_user.nome }}</strong><br>
                    {{ current_user.email }}
                </div>
            </div>
        </aside>
        
        <!-- CONTE√öDO PRINCIPAL -->
        <div class="main-content">
            <!-- HEADER -->
            <header class="header">
                <h2 style="margin: 0;">Solar Pro</h2>
                <div style="display: flex; gap: 1rem; align-items: center;">
                    <span style="color: var(--text-secondary);">{{ current_user.nome }}</span>
                    <button id="sidebar-toggle" style="display: none; background: none; border: none; color: var(--primary); font-size: 1.5rem; cursor: pointer;">‚ò∞</button>
                </div>
            </header>
            
            <!-- CONTE√öDO -->
            <div class="content">
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="alert alert-{{ category }}">
                                <span>{{ message }}</span>
                                <span class="alert-close" onclick="this.parentElement.remove()">√ó</span>
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}
                
                <!-- WELCOME BANNER -->
                <div class="dashboard-header">
                    <h1>Bem-vindo ao Solar Pro</h1>
                    <p>Sistema profissional de memoriais descritivos de homologa√ß√£o</p>
                    <div style="margin-top: 1.5rem;">
                        <a href="{{ url_for('novo_projeto') }}" class="btn btn-secondary" style="background-color: white; color: var(--primary);">
                            ‚ûï Novo Memorial
                        </a>
                    </div>
                </div>
                
                <!-- M√âTRICAS -->
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-icon">üìã</div>
                        <div class="metric-value">{{ metricas.total_projetos }}</div>
                        <div class="metric-label">memoriais criados</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-icon">‚ö°</div>
                        <div class="metric-value">{{ metricas.potencia_total | round(1) }} kWp</div>
                        <div class="metric-label">pot√™ncia total instalada</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-icon">‚úÖ</div>
                        <div class="metric-value">{{ metricas.projetos_concluidos }}</div>
                        <div class="metric-label">{% if metricas.total_projetos > 0 %}{{ (metricas.projetos_concluidos / metricas.total_projetos * 100) | round(0) | int }}{% else %}0{% endif %}% do total</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-icon">üîå</div>
                        <div class="metric-value">{{ metricas.total_modulos }}</div>
                        <div class="metric-label">m√≥dulos instalados</div>
                    </div>
                </div>
                
                <!-- TABELA DE PROJETOS -->
                <div style="margin-top: 2rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3>Projetos Recentes</h3>
                        <a href="{{ url_for('novo_projeto') }}" class="btn btn-secondary btn-small">Ver Todos ‚Üí</a>
                    </div>
                    
                    {% if projetos %}
                    <table class="projects-table">
                                <thead>
                                    <tr>
                                        <th>Cliente</th>
                                        <th>Localiza√ß√£o</th>
                                        <th>Pot√™ncia (kWp)</th>
                                        <th>Status</th>
                                        <th>A√ß√£o</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for projeto in projetos %}
                                        <tr>
                                            <td>{{ projeto.nome_cliente }}</td>
                                            <td>{{ projeto.cidade }}/{{ projeto.uf }}</td>
                                            <td>{{ projeto.potencia_kwp }}</td>
                                            <td>
                                                <span class="status-badge status-{{ projeto.status.lower().replace(' ', '-') }}">
                                                    {{ projeto.status }}
                                                </span>
                                            </td>
                                            <td>
                                                <a href="{{ url_for('editar_projeto', projeto_id=projeto.id) }}" class="btn btn-secondary btn-small">
                                                    Editar
                                                </a>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                    </table>
                    {% else %}
                    <div class="card">
                        <p style="text-align: center; color: var(--text-light); margin: 2rem 0;">
                            Nenhum projeto criado ainda. 
                            <a href="{{ url_for('novo_projeto') }}">Crie seu primeiro memorial ‚Üí</a>
                        </p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script>
        // Mostrar bot√£o de toggle em mobile
        if (window.innerWidth < 768) {
            document.getElementById('sidebar-toggle').style.display = 'block';
        }
        
        window.addEventListener('resize', function() {
            if (window.innerWidth >= 768) {
                document.getElementById('sidebar-toggle').style.display = 'none';
                document.querySelector('.sidebar').classList.remove('open');
            }
        });
    </script>
</body>
</html>
